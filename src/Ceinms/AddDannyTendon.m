%% Description - Basilio Goncalves (2020)
% https://www.researchgate.net/profile/Basilio_Goncalves
%-------------------------------------------------------------------------
%CALLBACK FUNTIONS (check if they are in the path)
%
%INPUT
%   DirCalibratedModel = [char] directory of the your ceinms calibrated
%   model
%       e.g. = 'E:\3-PhD\Data\MocapData\ElaboratedData\subject\session\ceinms\execution\simulations'
%   Tendon parameters (from DD)
%   a=str2num('0.0 0.001 0.002 0.003 0.004 0.005 0.006 0.007 0.008 0.009000000000000001 0.01 0.011 0.012 0.013000000000000001 0.014 0.015 0.016 0.017 0.018000000000000002 0.019 0.02 0.021 0.022 0.023 0.024 0.025 0.026000000000000002 0.027 0.028 0.029 0.03 0.031 0.032 0.033 0.034 0.035 0.036000000000000004 0.037 0.038 0.039 0.04 0.041 0.042 0.043000000000000003 0.044 0.045 0.046 0.047 0.048 0.049 0.05 0.051000000000000004 0.052000000000000005 0.053 0.054 0.055 0.056 0.057 0.058 0.059000000000000004 0.06 0.061 0.062 0.063 0.064 0.065 0.066 0.067 0.068 0.069 0.07 0.07100000000000001 0.07200000000000001 0.073 0.074 0.075 0.076 0.077 0.078 0.079 0.08 0.081 0.082 0.083 0.084 0.085 0.08600000000000001 0.08700000000000001 0.088 0.089 0.09 0.091 0.092 0.093 0.094 0.095 0.096 0.097 0.098 0.099 0.1 0.101 0.10200000000000001 0.10300000000000001 0.10400000000000001 0.105 0.106 0.107 0.108 0.109 0.11 0.111 0.112 0.113 0.114 0.115 0.116 0.117 0.11800000000000001 0.11900000000000001 0.12 0.121 0.122 0.123 0.124 0.125 0.126 0.127 0.128 0.129 0.13 0.131 0.132 0.133 0.134 0.135 0.136 0.137 0.138 0.139 0.14 0.14100000000000001 0.14200000000000002 0.14300000000000002 0.14400000000000002 0.145 0.146 0.147 0.148 0.149 0.15 0.151 0.152 0.153 0.154 0.155 0.156 0.157 0.158 0.159 0.16 0.161 0.162 0.163 0.164 0.165 0.166 0.167 0.168 0.169 0.17 0.171 0.17200000000000001 0.17300000000000001 0.17400000000000002 0.17500000000000002 0.176 0.177 0.178 0.179 0.18 0.181 0.182 0.183 0.184 0.185 0.186 0.187 0.188 0.189 0.19 0.191 0.192 0.193 0.194 0.195 0.196 0.197 0.198 0.199 0.2 0.201 0.202 0.203 0.20400000000000001 0.20500000000000002 0.20600000000000002 0.20700000000000002 0.20800000000000002 0.209 0.21 0.211 0.212 0.213 0.214 0.215 0.216 0.217 0.218 0.219 0.22 0.221 0.222 0.223 0.224 0.225 0.226 0.227 0.228 0.229 0.23 0.231 0.232 0.233 0.234 0.23500000000000001 0.23600000000000002 0.23700000000000002 0.23800000000000002 0.23900000000000002 0.24 0.241 0.242 0.243 0.244 0.245 0.246 0.247 0.248 0.249 0.25 0.251 0.252 0.253 0.254 0.255 0.256 0.257 0.258 0.259 0.26 0.261 0.262 0.263 0.264 0.265 0.266 0.267 0.268 0.269 0.27 0.271 0.272 0.273 0.274 0.275 0.276 0.277 0.278 0.279 0.28 0.281 0.28200000000000003 0.28300000000000003 0.28400000000000003 0.28500000000000003 0.28600000000000003 0.28700000000000003 0.28800000000000003 0.289 0.29 0.291 0.292 0.293 0.294 0.295 0.296 0.297 0.298 0.299');
%   a(2,:)=str2num('0.0 0.002705739832730144 0.010822959330920576 0.024071525799236326 0.03856473971858907 0.053057953637941815 0.06755116755729457 0.0820443814766473 0.09653759539600006 0.11103080931535281 0.12552402323470555 0.14001723715405828 0.15451045107341105 0.16900366499276379 0.18349687891211652 0.19799009283146926 0.21248330675082203 0.2269765206701748 0.24146973458952753 0.25596294850888024 0.270456162428233 0.28494937634758577 0.2994425902669385 0.31393580418629125 0.328429018105644 0.3429222320249968 0.3574154459443495 0.3719086598637022 0.38640187378305496 0.4008950877024077 0.41538830162176044 0.4298815155411132 0.44437472946046597 0.45886794337981873 0.4733611572991715 0.4878543712185242 0.5023475851378769 0.5168407990572297 0.5313340129765824 0.5458272268959352 0.560320440815288 0.5748136547346407 0.5893068686539935 0.6038000825733463 0.6182932964926988 0.6327865104120516 0.6472797243314043 0.6617729382507571 0.6762661521701099 0.6907593660894626 0.7052525800088154 0.7197457939281682 0.7342390078475209 0.7487322217668735 0.7632254356862263 0.777718649605579 0.7922118635249318 0.8067050774442845 0.8211982913636373 0.8356915052829901 0.8501847192023428 0.8646779331216956 0.8791711470410484 0.8936643609604011 0.9081575748797539 0.9226507887991067 0.9371440027184594 0.9516372166378122 0.966130430557165 0.9806236444765175 0.9951168583958703 1.009610072315223 1.0241032862345758 1.0385965001539283 1.0530897140732811 1.0675829279926339 1.0820761419119866 1.0965693558313394 1.1110625697506922 1.125555783670045 1.1400489975893977 1.1545422115087505 1.1690354254281032 1.183528639347456 1.1980218532668088 1.2125150671861615 1.2270082811055143 1.241501495024867 1.2559947089442196 1.2704879228635724 1.2849811367829251 1.299474350702278 1.3139675646216307 1.3284607785409834 1.3429539924603362 1.357447206379689 1.3719404202990417 1.3864336342183945 1.4009268481377473 1.4154200620571 1.4299132759764528 1.4444064898958056 1.4588997038151583 1.4733929177345109 1.4878861316538636 1.5023793455732164 1.516872559492569 1.5313657734119217 1.5458589873312745 1.5603522012506272 1.57484541516998 1.5893386290893328 1.6038318430086855 1.6183250569280383 1.632818270847391 1.6473114847667438 1.6618046986860966 1.6762979126054494 1.6907911265248021 1.705284340444155 1.7197775543635074 1.7342707682828602 1.748763982202213 1.7632571961215657 1.7777504100409185 1.7922436239602713 1.806736837879624 1.8212300517989768 1.8357232657183296 1.8502164796376823 1.864709693557035 1.8792029074763879 1.8936961213957406 1.9081893353150934 1.9226825492344461 1.937175763153799 1.9516689770731517 1.9661621909925044 1.980655404911857 1.9951486188312098 2.0096418327505625 2.0241350466699153 2.038628260589268 2.053121474508621 2.0676146884279736 2.082107902347326 2.0966011162666787 2.1110943301860314 2.125587544105384 2.140080758024737 2.1545739719440897 2.1690671858634425 2.1835603997827953 2.198053613702148 2.212546827621501 2.2270400415408536 2.2415332554602063 2.256026469379559 2.270519683298912 2.2850128972182646 2.2995061111376174 2.31399932505697 2.328492538976323 2.3429857528956757 2.3574789668150284 2.371972180734381 2.386465394653734 2.4009586085730867 2.4154518224924395 2.4299450364117923 2.444438250331145 2.458931464250498 2.4734246781698506 2.4879178920892033 2.502411106008556 2.516904319927909 2.531397533847261 2.545890747766614 2.5603839616859667 2.5748771756053195 2.5893703895246722 2.603863603444025 2.6183568173633778 2.6328500312827305 2.6473432452020833 2.661836459121436 2.676329673040789 2.6908228869601416 2.7053161008794944 2.719809314798847 2.7343025287182 2.7487957426375527 2.7632889565569054 2.777782170476258 2.792275384395611 2.8067685983149637 2.8212618122343165 2.8357550261536693 2.850248240073022 2.864741453992375 2.8792346679117276 2.8937278818310803 2.908221095750433 2.922714309669786 2.9372075235891386 2.951700737508491 2.9661939514278437 2.9806871653471965 2.9951803792665492 3.009673593185902 3.0241668071052548 3.038660021024607 3.05315323494396 3.0676464488633126 3.0821396627826654 3.096632876702018 3.111126090621371 3.1256193045407237 3.1401125184600764 3.154605732379429 3.169098946298782 3.1835921602181347 3.1980853741374875 3.2125785880568403 3.227071801976193 3.241565015895546 3.2560582298148986 3.2705514437342513 3.285044657653604 3.299537871572957 3.3140310854923096 3.3285242994116624 3.343017513331015 3.357510727250368 3.3720039411697207 3.3864971550890735 3.400990369008426 3.415483582927779 3.4299767968471317 3.4444700107664845 3.458963224685837 3.4734564386051896 3.4879496525245424 3.502442866443895 3.516936080363248 3.5314292942826007 3.5459225082019534 3.560415722121306 3.574908936040659 3.5894021499600117 3.6038953638793645 3.6183885777987173 3.63288179171807 3.647375005637423 3.6618682195567755 3.6763614334761283 3.690854647395481 3.705347861314834 3.7198410752341866 3.7343342891535394 3.748827503072892 3.763320716992245 3.7778139309115977 3.7923071448309504 3.806800358750303 3.821293572669656 3.8357867865890087 3.8502800005083615 3.8647732144277143 3.879266428347067 3.89375964226642 3.9082528561857726 3.9227460701051253 3.937239284024478 3.951732497943831 3.9662257118631836 3.980718925782536 3.995212139701889 4.009705353621242 4.024198567540595 4.0386917814599474 4.053184995379301 4.067678209298653 4.082171423218006 4.0966646371373585 4.111157851056712 4.125651064976064 4.140144278895417 4.15463749281477 4.169130706734122 4.183623920653474 4.198117134572827 4.21261034849218 4.227103562411533 4.241596776330885 4.2560899902502385 4.270583204169591 4.285076418088944 4.299569632008296 4.3140628459276495');
%   a = a';

%-------------------------------------------------------------------------
%OUTPUT
%
%--------------------------------------------------------------------------
% NOTE - you may need to change the names of the motions and muslces
%% EditCalibratedSubject

function AddDannyTendon(CEINMSxmlModel)

disp('adding new force-length for tendon based on (Devaprakash 2020)...')
fp = filesep;
XML = xml_read (CEINMSxmlModel);

Muscles = {'gasmed_' 'gaslat_' 'soleus_'};

for k = 1: length({XML.mtuSet.mtu.name})
    % strain curve from DD
    if contains(XML.mtuSet.mtu(k).name,Muscles)
        XML.mtuSet.mtu(k).curve.name = 'tendonForceStrain';
        XML.mtuSet.mtu(k).curve.xPoints ='0.0 0.001 0.002 0.003 0.004 0.005 0.006 0.007 0.008 0.009000000000000001 0.01 0.011 0.012 0.013000000000000001 0.014 0.015 0.016 0.017 0.018000000000000002 0.019 0.02 0.021 0.022 0.023 0.024 0.025 0.026000000000000002 0.027 0.028 0.029 0.03 0.031 0.032 0.033 0.034 0.035 0.036000000000000004 0.037 0.038 0.039 0.04 0.041 0.042 0.043000000000000003 0.044 0.045 0.046 0.047 0.048 0.049 0.05 0.051000000000000004 0.052000000000000005 0.053 0.054 0.055 0.056 0.057 0.058 0.059000000000000004 0.06 0.061 0.062 0.063 0.064 0.065 0.066 0.067 0.068 0.069 0.07 0.07100000000000001 0.07200000000000001 0.073 0.074 0.075 0.076 0.077 0.078 0.079 0.08 0.081 0.082 0.083 0.084 0.085 0.08600000000000001 0.08700000000000001 0.088 0.089 0.09 0.091 0.092 0.093 0.094 0.095 0.096 0.097 0.098 0.099 0.1 0.101 0.10200000000000001 0.10300000000000001 0.10400000000000001 0.105 0.106 0.107 0.108 0.109 0.11 0.111 0.112 0.113 0.114 0.115 0.116 0.117 0.11800000000000001 0.11900000000000001 0.12 0.121 0.122 0.123 0.124 0.125 0.126 0.127 0.128 0.129 0.13 0.131 0.132 0.133 0.134 0.135 0.136 0.137 0.138 0.139 0.14 0.14100000000000001 0.14200000000000002 0.14300000000000002 0.14400000000000002 0.145 0.146 0.147 0.148 0.149 0.15 0.151 0.152 0.153 0.154 0.155 0.156 0.157 0.158 0.159 0.16 0.161 0.162 0.163 0.164 0.165 0.166 0.167 0.168 0.169 0.17 0.171 0.17200000000000001 0.17300000000000001 0.17400000000000002 0.17500000000000002 0.176 0.177 0.178 0.179 0.18 0.181 0.182 0.183 0.184 0.185 0.186 0.187 0.188 0.189 0.19 0.191 0.192 0.193 0.194 0.195 0.196 0.197 0.198 0.199 0.2 0.201 0.202 0.203 0.20400000000000001 0.20500000000000002 0.20600000000000002 0.20700000000000002 0.20800000000000002 0.209 0.21 0.211 0.212 0.213 0.214 0.215 0.216 0.217 0.218 0.219 0.22 0.221 0.222 0.223 0.224 0.225 0.226 0.227 0.228 0.229 0.23 0.231 0.232 0.233 0.234 0.23500000000000001 0.23600000000000002 0.23700000000000002 0.23800000000000002 0.23900000000000002 0.24 0.241 0.242 0.243 0.244 0.245 0.246 0.247 0.248 0.249 0.25 0.251 0.252 0.253 0.254 0.255 0.256 0.257 0.258 0.259 0.26 0.261 0.262 0.263 0.264 0.265 0.266 0.267 0.268 0.269 0.27 0.271 0.272 0.273 0.274 0.275 0.276 0.277 0.278 0.279 0.28 0.281 0.28200000000000003 0.28300000000000003 0.28400000000000003 0.28500000000000003 0.28600000000000003 0.28700000000000003 0.28800000000000003 0.289 0.29 0.291 0.292 0.293 0.294 0.295 0.296 0.297 0.298 0.299';
        XML.mtuSet.mtu(k).curve.yPoints ='0.0 0.002705739832730144 0.010822959330920576 0.024071525799236326 0.03856473971858907 0.053057953637941815 0.06755116755729457 0.0820443814766473 0.09653759539600006 0.11103080931535281 0.12552402323470555 0.14001723715405828 0.15451045107341105 0.16900366499276379 0.18349687891211652 0.19799009283146926 0.21248330675082203 0.2269765206701748 0.24146973458952753 0.25596294850888024 0.270456162428233 0.28494937634758577 0.2994425902669385 0.31393580418629125 0.328429018105644 0.3429222320249968 0.3574154459443495 0.3719086598637022 0.38640187378305496 0.4008950877024077 0.41538830162176044 0.4298815155411132 0.44437472946046597 0.45886794337981873 0.4733611572991715 0.4878543712185242 0.5023475851378769 0.5168407990572297 0.5313340129765824 0.5458272268959352 0.560320440815288 0.5748136547346407 0.5893068686539935 0.6038000825733463 0.6182932964926988 0.6327865104120516 0.6472797243314043 0.6617729382507571 0.6762661521701099 0.6907593660894626 0.7052525800088154 0.7197457939281682 0.7342390078475209 0.7487322217668735 0.7632254356862263 0.777718649605579 0.7922118635249318 0.8067050774442845 0.8211982913636373 0.8356915052829901 0.8501847192023428 0.8646779331216956 0.8791711470410484 0.8936643609604011 0.9081575748797539 0.9226507887991067 0.9371440027184594 0.9516372166378122 0.966130430557165 0.9806236444765175 0.9951168583958703 1.009610072315223 1.0241032862345758 1.0385965001539283 1.0530897140732811 1.0675829279926339 1.0820761419119866 1.0965693558313394 1.1110625697506922 1.125555783670045 1.1400489975893977 1.1545422115087505 1.1690354254281032 1.183528639347456 1.1980218532668088 1.2125150671861615 1.2270082811055143 1.241501495024867 1.2559947089442196 1.2704879228635724 1.2849811367829251 1.299474350702278 1.3139675646216307 1.3284607785409834 1.3429539924603362 1.357447206379689 1.3719404202990417 1.3864336342183945 1.4009268481377473 1.4154200620571 1.4299132759764528 1.4444064898958056 1.4588997038151583 1.4733929177345109 1.4878861316538636 1.5023793455732164 1.516872559492569 1.5313657734119217 1.5458589873312745 1.5603522012506272 1.57484541516998 1.5893386290893328 1.6038318430086855 1.6183250569280383 1.632818270847391 1.6473114847667438 1.6618046986860966 1.6762979126054494 1.6907911265248021 1.705284340444155 1.7197775543635074 1.7342707682828602 1.748763982202213 1.7632571961215657 1.7777504100409185 1.7922436239602713 1.806736837879624 1.8212300517989768 1.8357232657183296 1.8502164796376823 1.864709693557035 1.8792029074763879 1.8936961213957406 1.9081893353150934 1.9226825492344461 1.937175763153799 1.9516689770731517 1.9661621909925044 1.980655404911857 1.9951486188312098 2.0096418327505625 2.0241350466699153 2.038628260589268 2.053121474508621 2.0676146884279736 2.082107902347326 2.0966011162666787 2.1110943301860314 2.125587544105384 2.140080758024737 2.1545739719440897 2.1690671858634425 2.1835603997827953 2.198053613702148 2.212546827621501 2.2270400415408536 2.2415332554602063 2.256026469379559 2.270519683298912 2.2850128972182646 2.2995061111376174 2.31399932505697 2.328492538976323 2.3429857528956757 2.3574789668150284 2.371972180734381 2.386465394653734 2.4009586085730867 2.4154518224924395 2.4299450364117923 2.444438250331145 2.458931464250498 2.4734246781698506 2.4879178920892033 2.502411106008556 2.516904319927909 2.531397533847261 2.545890747766614 2.5603839616859667 2.5748771756053195 2.5893703895246722 2.603863603444025 2.6183568173633778 2.6328500312827305 2.6473432452020833 2.661836459121436 2.676329673040789 2.6908228869601416 2.7053161008794944 2.719809314798847 2.7343025287182 2.7487957426375527 2.7632889565569054 2.777782170476258 2.792275384395611 2.8067685983149637 2.8212618122343165 2.8357550261536693 2.850248240073022 2.864741453992375 2.8792346679117276 2.8937278818310803 2.908221095750433 2.922714309669786 2.9372075235891386 2.951700737508491 2.9661939514278437 2.9806871653471965 2.9951803792665492 3.009673593185902 3.0241668071052548 3.038660021024607 3.05315323494396 3.0676464488633126 3.0821396627826654 3.096632876702018 3.111126090621371 3.1256193045407237 3.1401125184600764 3.154605732379429 3.169098946298782 3.1835921602181347 3.1980853741374875 3.2125785880568403 3.227071801976193 3.241565015895546 3.2560582298148986 3.2705514437342513 3.285044657653604 3.299537871572957 3.3140310854923096 3.3285242994116624 3.343017513331015 3.357510727250368 3.3720039411697207 3.3864971550890735 3.400990369008426 3.415483582927779 3.4299767968471317 3.4444700107664845 3.458963224685837 3.4734564386051896 3.4879496525245424 3.502442866443895 3.516936080363248 3.5314292942826007 3.5459225082019534 3.560415722121306 3.574908936040659 3.5894021499600117 3.6038953638793645 3.6183885777987173 3.63288179171807 3.647375005637423 3.6618682195567755 3.6763614334761283 3.690854647395481 3.705347861314834 3.7198410752341866 3.7343342891535394 3.748827503072892 3.763320716992245 3.7778139309115977 3.7923071448309504 3.806800358750303 3.821293572669656 3.8357867865890087 3.8502800005083615 3.8647732144277143 3.879266428347067 3.89375964226642 3.9082528561857726 3.9227460701051253 3.937239284024478 3.951732497943831 3.9662257118631836 3.980718925782536 3.995212139701889 4.009705353621242 4.024198567540595 4.0386917814599474 4.053184995379301 4.067678209298653 4.082171423218006 4.0966646371373585 4.111157851056712 4.125651064976064 4.140144278895417 4.15463749281477 4.169130706734122 4.183623920653474 4.198117134572827 4.21261034849218 4.227103562411533 4.241596776330885 4.2560899902502385 4.270583204169591 4.285076418088944 4.299569632008296 4.3140628459276495';
    end
    
end

%conver the curve data to strings
for k = 1:length({XML.mtuDefault.curve.xPoints})
    XML.mtuDefault.curve(k).xPoints = num2str(XML.mtuDefault.curve(k).xPoints);
    XML.mtuDefault.curve(k).yPoints = num2str(XML.mtuDefault.curve(k).yPoints);
end
cd(fileparts(CEINMSxmlModel))

% save model
prefXmlWrite.StructItem = false;  % allow arrays of structs to use 'item' notation
prefXmlWrite.CellItem   = false;
fileout = CEINMSxmlModel;
xml_write(fileout, XML, 'subject', prefXmlWrite);

cmdmsg(sprintf('Tendon stiffness curve added to uncalibrated model for Gastroc and Soleus'))

